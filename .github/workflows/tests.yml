name: Tests

on:
    pull_request:
env:
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  PRIVATE_REPO_ACCESS_TOKEN: ${{ secrets.ACTIONS_PRIVATE_REPO_RO_TOKEN }}
  STATA_LICENSE: ${{ secrets.STATA_LICENSE }}
jobs:

  test-docker:
    runs-on: ubuntu-latest
    name: Test docker image
    steps:
    - name: Checkout
      uses: actions/checkout@v3
    - name: Build image
      run: make docker-build
    - name: Run tests in docker-image
      run: |
        git config --list
        make docker-test ARGS='-e PRIVATE_REPO_ACCESS_TOKEN -e GIT_CONFIG_COUNT -e GIT_CONFIG_KEY_0 -e GIT_CONFIG_VALUE_0'
      env:
        GIT_CONFIG_COUNT: 1
        GIT_CONFIG_KEY_0: http.https://github.com/.extraheader
        GIT_CONFIG_VALUE_0:
