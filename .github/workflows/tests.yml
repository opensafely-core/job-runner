name: Tests

on:
    pull_request:

env:
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  PRIVATE_REPO_ACCESS_TOKEN: ${{ secrets.ACTIONS_PRIVATE_REPO_RO_TOKEN }}
  STATA_LICENSE: ${{ secrets.STATA_LICENSE }}

jobs:
  test-package-build:
    runs-on: ubuntu-latest
    name: Test we can build PyPI package
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Set up Python 3.8
        uses: actions/setup-python@v2
        with:
          python-version: 3.8
          cache: "pip"
          cache-dependency-path: requirements.*.txt

      # We need to set this to a valid version string in order to keep pip happy,
      # but it doesn't really matter what version we use
      - name: Set version
        run: echo '1.0' > VERSION
      - uses: extractions/setup-just@v1
      - name: Check that wheel installs and runs
        run: just package-test wheel
      - name: Check that sdist installs and runs
        run: just package-test sdist
